<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="Guowei Lv">
<meta name="generator" content="Hugo 0.25" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://lvguowei.me/css/style.css" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
<link rel="alternate" href="http://lvguowei.me/index.xml" type="application/rss+xml" title="Guowei Lv">
<title>Android Custom View 101 (Part V) - Guowei Lv</title>
</head>
<body>

<header>
  <div class="container clearfix">
    <a class="path" href="http://lvguowei.me/">[Guowei Lv]</a>
    <span class="caret"># _</span>
    <div class="right">
      
    </div>
  </div>
</header>

<div class="container">


<main role="main" class="article">
  
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2017-07-09">July 09, 2017</time></span>


    <span class="key">in</span>
    <span class="val">

        <a href="http://lvguowei.me/categories/programming">programming</a>

    </span>


    <br>
    <span class="key">tags:</span>
    <span class="val">

        <a href="http://lvguowei.me/tags/android">Android</a>

    </span>

  </div>
  <h1 class="headline" itemprop="headline">Android Custom View 101 (Part V)</h1>
  <section class="body" itemprop="articleBody">
    <p>In this post, we will discuss how to implement a custom view group by extending an existing one, like a <code>FrameLayout</code>.</p>

<p>Let&rsquo;s assume that we are building a layout for displaying user&rsquo;s avatar. The requirement is if a user has an avatar, show the avatar picture, if not, show their initials as text.</p>

<p>So it would be good if we have some kind of <code>AvatarView</code> and <code>Avatar</code> data class (which contains name and avatar picture). And then we can just do <code>avatarView.setAvatar(avatar)</code>, and handle the real avatar logic inside the <code>AvatarView</code>. Lets write some code.</p>

<p>Let&rsquo;s start by defining the <code>AvatarView</code>&rsquo;s layout xml:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;merge</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;ImageView</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/avatar_image&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;TextView</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/avatar_text&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:textSize=</span><span class="s">&quot;16sp&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/merge&gt;</span>
</code></pre></div>


<p>Notice that here we are not using a <code>FrameLayout</code> directly, instead we are using a <code>merge</code> tag. This is to avoid useless nested layout, let me explain.</p>

<p>If we use the <code>FrameLayout</code> in the xml file, and since the <code>AvatarView</code> will extends <code>FrameLayout</code> also, we will get something like:</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span>AvatarView(FrameLayout)
       |
       |
  FrameLayout (useless)
       |
      /\
     /  \
textview  imageview
</code></pre></div>


<p>So in order to get rid of the middle <code>FrameLayout</code>, we define the view&rsquo;s layout to not have a parent, and when it is inflated, it can then got merged into the <code>AvatarView</code>, which is itself a <code>FrameLayout</code>.</p>

<p>Then let&rsquo;s define the <code>AvatarView</code> class:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AvatarView</span> <span class="kd">extends</span> <span class="n">FrameLayout</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">ImageView</span> <span class="n">imageView</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">TextView</span> <span class="n">textView</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AvatarView</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="n">init</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">AvatarView</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">);</span>
        <span class="n">init</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">AvatarView</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">AttributeSet</span> <span class="n">attrs</span><span class="o">,</span> <span class="nd">@AttrRes</span> <span class="kt">int</span> <span class="n">defStyleAttr</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">attrs</span><span class="o">,</span> <span class="n">defStyleAttr</span><span class="o">);</span>
        <span class="n">init</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">inflate</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">avatar_view</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
        <span class="n">imageView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">avatar_image</span><span class="o">);</span>
        <span class="n">textView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">avatar_text</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAvatar</span><span class="o">(</span><span class="n">Avatar</span> <span class="n">avatar</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">avatar</span><span class="o">.</span><span class="na">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">imageView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">VISIBLE</span><span class="o">);</span>
            <span class="n">imageView</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">avatar</span><span class="o">.</span><span class="na">res</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">imageView</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">GONE</span><span class="o">);</span>
            <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">avatar</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>


<p>Notice that the <code>inflate()</code> method we pass in <code>this</code> as the parent. So the <code>merge</code> tag can be merged into this.</p>

<p>To set an avatar in an avtivity, we just do:</p>

<p><div class="highlight"><pre><code class="language-java" data-lang="java"><span></span> <span class="n">avatarView</span><span class="o">.</span><span class="na">setAvatar</span><span class="o">(</span><span class="k">new</span> <span class="n">Avatar</span><span class="o">(</span><span class="s">&quot;LV&quot;</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">));</span>
</code></pre></div>
</p>

<p>~THE END~</p>

  </section>

  <br/>

  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "lvguoweime" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>

</main>


</div>
<footer>
  <div class="container">
    <span class="copyright">&copy; 2017  Guowei Lv</span>
  </div>
</footer>

</body>
</html>

